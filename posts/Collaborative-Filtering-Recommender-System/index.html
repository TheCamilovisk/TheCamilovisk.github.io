<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Collaborative Filtering based Recommender System | Camilo Gonçalves</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Collaborative Filtering based Recommender System" /><meta name="author" content="Camilo Gonçalves" /><meta property="og:locale" content="en_US" /><meta name="description" content="Recommender systems are one of the most successful and widespread application of machine learning technologies in industry. The ability to suggest products with most appealing factor to each consumer type of your clients base is trivial not only to keep your clients engaged, but to atract new costumers. The business model and success of big companys like Netflix, Amazon, Steam, Spotify, YouTube and many others, revolves around the potency of their Recommender Systems." /><meta property="og:description" content="Recommender systems are one of the most successful and widespread application of machine learning technologies in industry. The ability to suggest products with most appealing factor to each consumer type of your clients base is trivial not only to keep your clients engaged, but to atract new costumers. The business model and success of big companys like Netflix, Amazon, Steam, Spotify, YouTube and many others, revolves around the potency of their Recommender Systems." /><link rel="canonical" href="https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/" /><meta property="og:url" content="https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/" /><meta property="og:site_name" content="Camilo Gonçalves" /><meta property="og:image" content="https://thecamilovisk.github.io//assets/img/posts/CFRecommenderSystem/recommender_systems.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-07T00:08:00-03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://thecamilovisk.github.io//assets/img/posts/CFRecommenderSystem/recommender_systems.png" /><meta property="twitter:title" content="Collaborative Filtering based Recommender System" /><meta name="twitter:site" content="@camilolgon" /><meta name="twitter:creator" content="@Camilo Gonçalves" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/"},"description":"Recommender systems are one of the most successful and widespread application of machine learning technologies in industry. The ability to suggest products with most appealing factor to each consumer type of your clients base is trivial not only to keep your clients engaged, but to atract new costumers. The business model and success of big companys like Netflix, Amazon, Steam, Spotify, YouTube and many others, revolves around the potency of their Recommender Systems.","@type":"BlogPosting","url":"https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/","headline":"Collaborative Filtering based Recommender System","dateModified":"2021-01-07T00:08:00-03:00","datePublished":"2021-01-07T00:08:00-03:00","image":"https://thecamilovisk.github.io//assets/img/posts/CFRecommenderSystem/recommender_systems.png","author":{"@type":"Person","name":"Camilo Gonçalves"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Camilo Gonçalves</a></div><div class="site-subtitle font-italic">Data Scientist and Computer Vision Researcher.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/TheCamilovisk" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/camilo-assis-a9712669/" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:window.open('mailto:' + ['camilolgon','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Collaborative Filtering based Recommender System</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Collaborative Filtering based Recommender System</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jan 7, 2021, 12:08 AM -0300" > Jan 7 <i class="unloaded">2021-01-07T00:08:00-03:00</i> </span> by <span class="author"> Camilo Gonçalves </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/CFRecommenderSystem/recommender_systems.png" class="post-preview-img"><p>Recommender systems are one of the most successful and widespread application of machine learning technologies in industry. The ability to suggest products with most appealing factor to each consumer type of your clients base is trivial not only to keep your clients engaged, but to atract new costumers. The business model and success of big companys like Netflix, Amazon, Steam, Spotify, YouTube and many others, revolves around the potency of their <em>Recommender Systems</em>.</p><p>A recommender system deals with the task of predict the degree of similarity between items (movies, songs, clothing, shoes, etc) or users in a database. Based on these similarities the system can provide personalized <em>recommendations</em> of items for users.</p><p>Generally speaking, recommender systems can be classified into 3 types:</p><ul><li><p><strong>Collaborative Filtering based:</strong> These systems predict the rating or preference that a user would give an item based on past user ratings or preferences. No item metadata is required, in contrast to its content-based counterparts.</p></li><li><p><strong>Content-based Filtering:</strong> These systems predict the item rating or user preference based on item metadata (genre, director, description, actors, color, etc) and user preferences and history. These systems dependes highly on item metadata.</p></li><li><p><strong>Hybrid systems:</strong> These systems try to leverage the best of both worlds and constitutes a wide range of state-of-art techniques in industry. These are complex systems, usually made of multiple smaller subsystems.</p></li></ul><p>Those system types have their own pros and cons. In this post we’ll implement a simple Collaborative Filtering based system.</p><h1 id="collaborative-filtering">Collaborative Filtering</h1><p>As said before, Collabortative Filtering (CF) is a type of recommendation technique that uses similarities between users (or items) to infer the possible level of interest of a user to a item unrated by him. These similarities are computed using sonenly existing user ratings for items. Thus specific item description metadata is not needed.</p><p>There are two general CF approaches:</p><ul><li><strong>User-based</strong>, which exploits similarities between <strong>users</strong>. A rating prediction of an user to an item is computed using the item ratings given by similar users.</li><li><strong>Item-based</strong>, which exploits similarities between <strong>items</strong>. A rating prediction of an user to an item is computed using ratings of similar items.</li></ul><figure style="display: block; margin-left: auto; margin-right: auto; width: 90%; text-align: center;"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/CFRecommenderSystem/CF_approachs.png" alt="CF approaches." /><figcaption>Collaborative Filtering approaches.</figcaption></figure><p>In both cases, the first step to build the system is to compute an <strong>interactions matrix</strong>, where each row contains the ratings given by a user to all items in database, and each columns contains the ratings given by all users to an specific item.</p><p>Figure below illustrate an example interactions matrix. User ratings are in range 1 to 5. A rating 0 means that this specific item was not rated by this specific user.</p><figure style="display: block; margin-left: auto; margin-right: auto; width: 90%; text-align: center;"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/CFRecommenderSystem/sample_iter_mat.png" alt="Example interaction matrix" /><figcaption>Example interaction matrix</figcaption></figure><p>The <strong>interactions matrix</strong> is, naturally, an <em>sparse matrix</em>: in practical scenarios, the majority of the users may not have rated the majority of the items. This may lead to adoption of specific algorithms to deal with sparse data.</p><p>Two main algorithm types are used to implement recommender systems (either item-based or user-based):</p><ul><li><p><strong>Memory based</strong>, in which statistical techniques are applied to the entire dataset to calculate the rating predictions.</p></li><li><p><strong>Model based</strong>, which involve steps to reduce or compress the large, but possibly sparse, interactions matrix.</p></li></ul><p>In this post, we’ll use a <em>memory based</em> strategy, which is simpler to explain and easier to understand. In a future post we’ll cover the implementation of a <em>model based</em> approach.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">gp_minimize</span>
<span class="kn">from</span> <span class="nn">skopt.space</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Categorical</span>
<span class="kn">from</span> <span class="nn">skopt.utils</span> <span class="kn">import</span> <span class="n">use_named_args</span>
<span class="kn">from</span> <span class="nn">skopt.plots</span> <span class="kn">import</span> <span class="n">plot_convergence</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">import</span> <span class="nn">re</span>
</pre></table></code></div></div><h1 id="the-movielens-100k-dataset">The MovieLens 100K Dataset</h1><p>There are a number of datasets available for recommendations systems research. Amongst them, the <a href="https://grouplens.org/datasets/movielens">MovieLens</a> dataset is probably one of the more popular ones. MovieLens is a non-commercial web-based movie recommender system, created in 1997 and run by the GroupLens Research Project, at University of Minnesota. It’s data has been critical for several research studies including personalized recommendation and social psychology.</p><p>There are several versions of the dataset available. We’ll use the well-known <a href="https://grouplens.org/datasets/movielens/100k/">MovieLens 100k</a>, which consists of 100,000 ratings form 943 users on 1682 movies. Some simple demographic information such as age, gender, genres for the users and items are also available, but we’ll not use them.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1"># # Download the dataset
# !wget http://files.grouplens.org/datasets/movielens/ml-100k.zip
# # Unzip it
# !unzip ml-100k.zip
# # Get rid of the .zip file
# !rm ml-100k.zip
</span></pre></table></code></div></div><p>The dataset folder contains several files, but we need only two of them:</p><ul><li><strong>u.data</strong>: The full dataset with 100,000 user ratings. Each user has rated at least 20 movies.</li><li><strong>u.item</strong>: Contains informations about the movies, but we will use only movies ids and titles. This data is not required for the understanding of the CF technique, but we will use it for a more friendly feedback of our system.</li></ul><p>Let’s begin by loading the ratings dataframe.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s">"ml-100k/u.data"</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span> <span class="c1"># this is a tab separated data
</span>    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"user_id"</span><span class="p">,</span> <span class="s">"movie_id"</span><span class="p">,</span> <span class="s">"rating"</span><span class="p">,</span> <span class="s">"timestamp"</span><span class="p">],</span> <span class="c1"># the columns names
</span>    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s">"user_id"</span><span class="p">,</span> <span class="s">"movie_id"</span><span class="p">,</span> <span class="s">"rating"</span><span class="p">],</span> <span class="c1"># we do not need the timestamp column
</span>    <span class="n">low_memory</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
<span class="n">ratings</span>
</pre></table></code></div></div><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>user_id<th>movie_id<th>rating<tbody><tr><th>0<td>196<td>242<td>3<tr><th>1<td>186<td>302<td>3<tr><th>2<td>22<td>377<td>1<tr><th>3<td>244<td>51<td>2<tr><th>4<td>166<td>346<td>1<tr><th>...<td>...<td>...<td>...<tr><th>99995<td>880<td>476<td>3<tr><th>99996<td>716<td>204<td>5<tr><th>99997<td>276<td>1090<td>1<tr><th>99998<td>13<td>225<td>2<tr><th>99999<td>12<td>203<td>3</table><p>100000 rows × 3 columns</p></div><p>Each entry consists in a <em>user_id</em>, <em>movie_id</em> and a movie <em>rating</em> in range of 1 to 5.</p><p>The next information we need is the number of movies and users in the dataset. Although we already know this from the dataset information, for didactic purposes we’ll get them from the data itself.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">n_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">.</span><span class="n">user_id</span><span class="p">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">n_movies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">.</span><span class="n">movie_id</span><span class="p">.</span><span class="n">unique</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Number of users: </span><span class="si">{</span><span class="n">n_users</span><span class="si">}</span><span class="s"> -- Number of movies: </span><span class="si">{</span><span class="n">n_movies</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Number of users: 943 -- Number of movies: 1682
</pre></table></code></div></div><h2 id="traintest-split">Train/test split</h2><p>Now we’ll create the train and test sets that we will use to evaluate the performance of our system. 20% of each user ratings will be used for testing, and the remaining that will be used for training.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">test_perc</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="c1"># Initialize the train and test dataframes.
</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Check each user.
</span><span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">.</span><span class="n">user_id</span><span class="p">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">user_df</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">ratings</span><span class="p">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">].</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span> <span class="c1"># select only samples of the actual user and shuffle the resulting dataframe
</span>    
    <span class="n">n_entries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_df</span><span class="p">)</span>
    <span class="n">n_test</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">test_perc</span> <span class="o">*</span> <span class="n">n_entries</span><span class="p">))</span>
    
    <span class="n">test_set</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">((</span><span class="n">test_set</span><span class="p">,</span> <span class="n">user_df</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n_test</span><span class="p">)))</span>
    <span class="n">train_set</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">((</span><span class="n">train_set</span><span class="p">,</span> <span class="n">user_df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_entries</span> <span class="o">-</span> <span class="n">n_test</span><span class="p">)))</span>

<span class="n">train_set</span> <span class="o">=</span> <span class="n">train_set</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="n">test_set</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">train_set</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test_set</span><span class="p">.</span><span class="n">shape</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>((80000, 3), (20000, 3))
</pre></table></code></div></div><p>We also need a function to compute the <em>interactions matrix</em> of a given ratings dataframe.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">build_interactions_matrix</span><span class="p">(</span><span class="n">r_mat</span><span class="p">,</span> <span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">):</span>
    <span class="n">iter_m</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">r_mat</span><span class="p">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="n">iter_m</span><span class="p">[</span><span class="n">user_id</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">movie_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rating</span>
    
    <span class="k">return</span> <span class="n">iter_m</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">iter_m</span> <span class="o">=</span> <span class="n">build_interactions_matrix</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">)</span>
<span class="n">iter_m</span><span class="p">.</span><span class="n">shape</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(943, 1682)
</pre></table></code></div></div><h2 id="memory-based-approach">Memory based approach</h2><p>In this post we’ll build our system using the <strong>memory based</strong> approach, in which similarities between users/items are computed using the rating data itself. Therefore, the <em>i</em>-th row of an interactions matrix is considered as the <strong>feature vector</strong> of user <em>i</em>, while the <em>j</em>-th column of an interaction matrix is considered as the <strong>feature vector</strong> of item <em>j</em>.</p><figure style="display: block; margin-left: auto; margin-right: auto; width: 90%; text-align: center;"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/CFRecommenderSystem/memory_based.png" alt="Feature vectors in CF memory-based approach" /><figcaption>Feature vectors in CF memory-based approach</figcaption></figure><p>The similarity between two users is represented by some <strong>distance measurement</strong> between their feature vectors. Multiple measures, such as Pearson correlation and vector cosine are used for this. For example, the similarity between users \(u\) and \(u'\) can be computed using vector cosine as:</p>\[sim(u, u') = cos(\textbf{r}_u, \textbf{r}_{u'}) = \frac{\textbf{r}_u \textbf{.} \textbf{r}_{u'}}{|\textbf{r}_u||\textbf{r}_{u'}|} = \frac{\sum_i r_{ui}r_{u'i}}{\sqrt{\sum_i r_{ui}^2}\sqrt{\sum_i r_{u'i}^2}}\]<p>where \(u\) and \(\textbf{r}_{u'}\) are the feature vectors of users \(u\) and \(u'\), respectively, and \(r_{ui}\) is a rating value given by user \(u\) to item \(i\). The same procedure is applied when computing the similarity between items \(i\) and \(i'\).</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">build_similarity_matrix</span><span class="p">(</span><span class="n">interactions_matrix</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">):</span>
    <span class="c1"># takes rows as user features
</span>    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">"user"</span><span class="p">:</span>
        <span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">interactions_matrix</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">interactions_matrix</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
    <span class="c1"># takes columns as item features
</span>    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">"item"</span><span class="p">:</span>
        <span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">interactions_matrix</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">interactions_matrix</span><span class="p">)</span>
    <span class="n">norms</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">.</span><span class="n">diagonal</span><span class="p">())</span> <span class="o">+</span> <span class="n">eps</span>
    <span class="k">return</span> <span class="n">similarity_matrix</span> <span class="o">/</span> <span class="p">(</span><span class="n">norms</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">norms</span><span class="p">[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">])</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">u_sim</span> <span class="o">=</span> <span class="n">build_similarity_matrix</span><span class="p">(</span><span class="n">iter_m</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">)</span>
<span class="n">i_sim</span> <span class="o">=</span> <span class="n">build_similarity_matrix</span><span class="p">(</span><span class="n">iter_m</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"User similarity matrix shape: </span><span class="si">{</span><span class="n">u_sim</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="se">\n</span><span class="s">User similarity matrix sample:</span><span class="se">\n</span><span class="si">{</span><span class="n">u_sim</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">97</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Item similarity matrix shape: </span><span class="si">{</span><span class="n">i_sim</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="se">\n</span><span class="s">Item similarity matrix sample:</span><span class="se">\n</span><span class="si">{</span><span class="n">i_sim</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>User similarity matrix shape: (943, 943)
User similarity matrix sample:
[[1.         0.16693098 0.04745954 0.06435782]
 [0.16693098 1.         0.11059132 0.17812119]
 [0.04745954 0.11059132 1.         0.34415072]
 [0.06435782 0.17812119 0.34415072 1.        ]]
-------------------------------------------------------------------------------------------------
Item similarity matrix shape: (1682, 1682)
Item similarity matrix sample:
[[1.         0.40238218 0.33024479 0.45493792]
 [0.40238218 1.         0.27306918 0.50257077]
 [0.33024479 0.27306918 1.         0.32486639]
 [0.45493792 0.50257077 0.32486639 1.        ]]
</pre></table></code></div></div><p>The similarity matrix is a symmetric matrix with values in range 0 to 1. The diagonal elements contains the auto-similarities of all users/items, so all elements are equal to 1.</p><h1 id="making-predictions">Making Predictions</h1><p>Now we are able to make predictions. Depending on which approach we have chosen for our system, we have two different objectives:</p><ol><li>If we choose the user-based approach, we’ll infer a missing rating \(r_{ui}\) of an user \(u\) to an item \(i\) by taking the normalized weighted sum of <strong>all ratings of other users to this item</strong>.</li></ol>\[r_{ui} = \frac{\sum_{u'} sim(u, u')r_{u'i}}{\sum_{u'} |sim(u, u')|}\]<ol><li>If we choose the item-based approach instead, we’ll infer a missing rating \(r_{ui}\) of an user \(u\) to an item \(i\) by taking the normalized weighted sum of <strong>all other ratings of this user to the other items</strong>.</li></ol>\[r_{ui} = \frac{\sum_{i'} sim(i, i')r_{ui'}}{\sum_{i'} |sim(i, i')|}\]<h2 id="the-recommender-class">The Recommender class</h2><p>Let’s build a <em>Recommender</em> class, that will do all the heavy lifting of compute/store the similarity matrices and make rating predictions for us.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Recommender</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_users</span><span class="p">,</span>
        <span class="n">n_items</span><span class="p">,</span>
        <span class="n">r_mat</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span> <span class="o">=</span> <span class="n">build_interactions_matrix</span><span class="p">(</span><span class="n">r_mat</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span> <span class="o">=</span> <span class="n">build_similarity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_predict_all</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_predict_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"user"</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"item"</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">predictions</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="s">"User-based predictions sample:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">).</span><span class="n">predictions</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">97</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"item-based predictions sample:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">).</span><span class="n">predictions</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>User-based predictions sample:
[[1.83706987 0.6257035  0.33869847 1.00876026]
 [1.5422442  0.27024912 0.23318095 0.48654518]
 [0.9610046  0.22919461 0.16521262 0.38923742]
 [1.2288292  0.27348381 0.20238746 0.47424947]]
-------------------------------------------------------------------------------------------------
item-based predictions sample:
[[0.97004593 0.88005233 0.88561114 0.94116817]
 [0.23553281 0.1252388  0.17800975 0.15055959]
 [0.08729475 0.0632449  0.0812641  0.06648524]
 [0.07542813 0.05258989 0.06783286 0.05653723]]
</pre></table></code></div></div><h2 id="model-evaluation">Model evaluation</h2><p>Now it’s time to assess the predictor performance. For this we’ll use <em>Mean Squared Error</em> (MSE) metric.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">build_predictions_df</span><span class="p">(</span><span class="n">preds_m</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">):</span>
    <span class="n">preds_v</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="p">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="n">preds_v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds_m</span><span class="p">[</span><span class="n">user_id</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">movie_id</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">preds_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">"user_id"</span><span class="p">:</span> <span class="n">dataframe</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="s">"movie_id"</span><span class="p">:</span> <span class="n">dataframe</span><span class="p">.</span><span class="n">movie_id</span><span class="p">,</span> <span class="s">"rating"</span><span class="p">:</span> <span class="n">preds_v</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">preds_df</span>

<span class="k">def</span> <span class="nf">get_mse</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">):</span>
    <span class="n">train_preds</span> <span class="o">=</span> <span class="n">build_predictions_df</span><span class="p">(</span><span class="n">estimator</span><span class="p">.</span><span class="n">predictions</span><span class="p">,</span> <span class="n">train_set</span><span class="p">)</span>
    <span class="n">test_preds</span> <span class="o">=</span> <span class="n">build_predictions_df</span><span class="p">(</span><span class="n">estimator</span><span class="p">.</span><span class="n">predictions</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
    
    <span class="n">train_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">train_set</span><span class="p">.</span><span class="n">rating</span><span class="p">,</span> <span class="n">train_preds</span><span class="p">.</span><span class="n">rating</span><span class="p">)</span>
    <span class="n">test_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_set</span><span class="p">.</span><span class="n">rating</span><span class="p">,</span> <span class="n">test_preds</span><span class="p">.</span><span class="n">rating</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span>
    <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">),</span>
    <span class="n">train_set</span><span class="p">,</span>
    <span class="n">test_set</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"User-based train MSE: </span><span class="si">{</span><span class="n">train_mse</span><span class="si">}</span><span class="s"> -- User-based test MSE: </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">97</span><span class="p">)</span>

<span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span>
    <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">),</span>
    <span class="n">train_set</span><span class="p">,</span>
    <span class="n">test_set</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Item-based train MSE: </span><span class="si">{</span><span class="n">train_mse</span><span class="si">}</span><span class="s"> -- Item-based test MSE: </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>User-based train MSE: 8.70310424270717 -- User-based test MSE: 8.914272669040075
-------------------------------------------------------------------------------------------------
Item-based train MSE: 9.436480326757003 -- Item-based test MSE: 9.726712690862362
</pre></table></code></div></div><h2 id="k-nearest-neighbors">K-nearest neighbors</h2><p>At this point the rating predictions are computed using the ratings of either all users or all items. This means that even the users/items with low similarity scores will be acounted for the prediction computation. A better approach is to take an smaller subset of the most similar users/items to make a prediction. This technique is usually refered as <em>k-nearest neighbors</em>, or <em>KNN</em> algorithm.</p><p>We’ll adapt our Estimator class to use only the most similar users/items to make an prediction.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Recommender</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_users</span><span class="p">,</span>
        <span class="n">n_items</span><span class="p">,</span>
        <span class="n">r_mat</span><span class="p">,</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="c1"># the number of neighbors to use when computing the similarity score
</span>        <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span> <span class="o">=</span> <span class="n">build_interactions_matrix</span><span class="p">(</span><span class="n">r_mat</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span> <span class="o">=</span> <span class="n">build_similarity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_predict_all</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_predict_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"user"</span><span class="p">:</span>
            <span class="c1"># An user has the higher similarity score with itself,
</span>            <span class="c1"># so we skip the first element.
</span>            <span class="n">sorted_ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_ids</span><span class="p">):</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span><span class="p">].</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">[</span><span class="n">k_users</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"item"</span><span class="p">:</span>
            <span class="c1"># An item has the higher similarity score with itself,
</span>            <span class="c1"># so we skip the first element.
</span>            <span class="n">sorted_ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_ids</span><span class="p">):</span>
                <span class="n">pred</span><span class="p">[:,</span> <span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span><span class="p">].</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">[:,</span> <span class="n">k_items</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
                <span class="n">pred</span><span class="p">[:,</span> <span class="n">item_id</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pred</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span>
    <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">),</span>
    <span class="n">train_set</span><span class="p">,</span>
    <span class="n">test_set</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"User-based train MSE: </span><span class="si">{</span><span class="n">train_mse</span><span class="si">}</span><span class="s"> -- User-based test MSE: </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">97</span><span class="p">)</span>

<span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span>
    <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">),</span>
    <span class="n">train_set</span><span class="p">,</span>
    <span class="n">test_set</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Item-based train MSE: </span><span class="si">{</span><span class="n">train_mse</span><span class="si">}</span><span class="s"> -- Item-based test MSE: </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>User-based train MSE: 5.490605431419921 -- User-based test MSE: 6.174640689172994
-------------------------------------------------------------------------------------------------
Item-based train MSE: 4.985672850673028 -- Item-based test MSE: 5.713362919538133
</pre></table></code></div></div><p>As we can see, this method alone can improve greatly our system’s prediction power. Later in this post, we’ll try leverage the effect of the number of neighbors to do a simple tunning in our system.</p><h2 id="bias-subtraction">Bias subtraction</h2><p>Now we’ll try to deal with the rating bias associated with an user or an item. The ideia here is that certain users may tend to always give high or low ratings to all movies, so the <em>relative difference</em> in ratings may be more important than the <em>absolute rating</em> values.</p><p>For a user-based approach this methodology can be mathematically described as:</p>\[r_{ui} = \overline{r}_{u} + \frac{\sum_{u'} sim(u, u')(r_{u'i} - \overline{r}_{u'})}{\sum_{u'} |sum(u, u')|}\]<p>where \(\overline{r}_{u}\) is the average rating given by user \(u\), or for a item-based approach as:</p>\[r_{ui} = \overline{r}_{i} + \frac{\sum_{i'} sim(i, i')(r_{ui'} - \overline{r}_{i'})}{\sum_{i'} |sum(i, i')|}\]<p>where \(\overline{r}_{i}\) is the average rating of item \(i\)</p><p>Lets modify our <em>Recommender</em> class once more to include this feature.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Recommender</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_users</span><span class="p">,</span>
        <span class="n">n_items</span><span class="p">,</span>
        <span class="n">r_mat</span><span class="p">,</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span>
        <span class="n">bias_sub</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span> <span class="o">=</span> <span class="n">build_interactions_matrix</span><span class="p">(</span><span class="n">r_mat</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span> <span class="o">=</span> <span class="n">build_similarity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span> <span class="o">=</span> <span class="n">bias_sub</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_predict_all</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_predict_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"user"</span><span class="p">:</span>
            <span class="c1"># Computes the new interaction matrix if needed.
</span>            <span class="n">iter_m</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">user_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>
                <span class="n">iter_m</span> <span class="o">-=</span> <span class="n">user_bias</span>
            <span class="c1"># An user has the higher similarity score with itself,
</span>            <span class="c1"># so we skip the first element.
</span>            <span class="n">sorted_ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_ids</span><span class="p">):</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span><span class="p">].</span><span class="n">dot</span><span class="p">(</span><span class="n">iter_m</span><span class="p">[</span><span class="n">k_users</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/=</span> \
                    <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">pred</span> <span class="o">+=</span> <span class="n">user_bias</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"item"</span><span class="p">:</span>
            <span class="c1"># Computes the new interaction matrix if needed.
</span>            <span class="n">iter_m</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">item_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">iter_m</span> <span class="o">-=</span> <span class="n">item_bias</span>
            <span class="c1"># An item has the higher similarity score with itself,
</span>            <span class="c1"># so we skip the first element.
</span>            <span class="n">sorted_ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_ids</span><span class="p">):</span>
                <span class="n">pred</span><span class="p">[:,</span> <span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span><span class="p">].</span><span class="n">dot</span><span class="p">(</span><span class="n">iter_m</span><span class="p">[:,</span> <span class="n">k_items</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
                <span class="n">pred</span><span class="p">[:,</span> <span class="n">item_id</span><span class="p">]</span> <span class="o">/=</span> \
                    <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">pred</span> <span class="o">+=</span> <span class="n">item_bias</span>
                
        <span class="k">return</span> <span class="n">pred</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span>
    <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span> <span class="n">bias_sub</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">train_set</span><span class="p">,</span>
    <span class="n">test_set</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"User-based train MSE: </span><span class="si">{</span><span class="n">train_mse</span><span class="si">}</span><span class="s"> -- User-based test MSE: </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">97</span><span class="p">)</span>

<span class="n">train_mse</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span>
    <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">,</span> <span class="n">bias_sub</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">train_set</span><span class="p">,</span>
    <span class="n">test_set</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Item-based train MSE: </span><span class="si">{</span><span class="n">train_mse</span><span class="si">}</span><span class="s"> -- Item-based test MSE: </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>User-based train MSE: 5.6854492668354295 -- User-based test MSE: 6.394565262018779
-------------------------------------------------------------------------------------------------
Item-based train MSE: 5.427174754760854 -- Item-based test MSE: 6.214109193478462
</pre></table></code></div></div><p>Although this methodology did not improved the results for this scenario, possibly due to the characteristics of the dataset, it can be effective with another dataset.</p><h1 id="tuning-up">Tuning up</h1><p>There is one question left: how do we find the right number of similar users/items we should use when predicting a rating?</p><p>The author of the <a href="https://www.ethanrosenthal.com/2015/11/02/intro-to-collaborative-filtering/">blog post</a> that we this post was based used the so-called <a href="https://en.wikipedia.org/wiki/Elbow_method_(clustering)">Elbow Method</a> to find the value of <em>k</em>. Although this is a fine methodology, I’m personally more inclined to use more programatic ways to achieve those kind of goals.</p><p>If you thought of model hyperparameters search methods, like grid-search or random-search, then we are in the same line of thinking.</p><p><em>Scikit-learn</em> package already has some standart implementations of these methods based on <em>cross-validation scores</em>, but these are quite limited to <em>scikit-learn</em>’s own model implementation style. Although we could certainly implement our own parameters search routines, here I optioned to use the <a href="https://scikit-optimize.github.io/stable/"><em>scikit-optimize</em></a> package. It’s simple and powerful interface is a <em>must-use</em> tool for any <em>Machine Learning</em> practitioneer, and despite my plans to write a dedicated post to talk about this tool, this is a great oportunity to use it.</p><p>We begin by defining our hyperparameter search space. Our use case is quite simple, as we have only two parameters (<em>k</em> and <em>bias_sub</em>).</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1"># The list of hyper-parameters we want to optmizer. For each one we define the bounds
# and the corresponding name.
</span><span class="n">space</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Integer</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"k"</span><span class="p">),</span>
    <span class="n">Categorical</span><span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">"bias_sub"</span><span class="p">)</span>
<span class="p">)</span>
</pre></table></code></div></div><p>Now we define an objective function, that simply represents how well the defined model fared with a given set of parameters.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1"># This decorator allows your objetive function to receive the parameters as keyword arguments.
</span><span class="o">@</span><span class="n">use_named_args</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_movies</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="c1"># we'll check the scores against the test set
</span>    <span class="n">_</span><span class="p">,</span> <span class="n">test_mse</span> <span class="o">=</span> <span class="n">get_mse</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_mse</span>
</pre></table></code></div></div><p>Now we call scikit-optimize’s <a href="https://scikit-optimize.github.io/stable/modules/generated/skopt.gp_minimize.html">gp_minimize</a> function with our objective function and our defined search space.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">res_gp</span> <span class="o">=</span> <span class="n">gp_minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">n_calls</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Best score: </span><span class="si">{</span><span class="n">res_gp</span><span class="p">.</span><span class="n">fun</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre><td class="rouge-code"><pre>Iteration No: 1 started. Evaluating function at random point.
Iteration No: 1 ended. Evaluation done at random point.
Time taken: 2.4368
Function value obtained: 6.8164
Current minimum: 6.8164
Iteration No: 2 started. Evaluating function at random point.
Iteration No: 2 ended. Evaluation done at random point.
Time taken: 2.1419
Function value obtained: 6.9131
Current minimum: 6.8164
Iteration No: 3 started. Evaluating function at random point.
Iteration No: 3 ended. Evaluation done at random point.
Time taken: 1.4967
Function value obtained: 6.2713
Current minimum: 6.2713
Iteration No: 4 started. Evaluating function at random point.
Iteration No: 4 ended. Evaluation done at random point.
Time taken: 1.2882
Function value obtained: 6.2901
Current minimum: 6.2713
Iteration No: 5 started. Evaluating function at random point.
Iteration No: 5 ended. Evaluation done at random point.
Time taken: 0.7243
Function value obtained: 6.1841
Current minimum: 6.1841
Iteration No: 6 started. Evaluating function at random point.
Iteration No: 6 ended. Evaluation done at random point.
Time taken: 0.5978
Function value obtained: 6.0290
Current minimum: 6.0290
Iteration No: 7 started. Evaluating function at random point.
Iteration No: 7 ended. Evaluation done at random point.
Time taken: 2.7046
Function value obtained: 7.0044
Current minimum: 6.0290
Iteration No: 8 started. Evaluating function at random point.
Iteration No: 8 ended. Evaluation done at random point.
Time taken: 2.6395
Function value obtained: 7.0781
Current minimum: 6.0290
Iteration No: 9 started. Evaluating function at random point.
Iteration No: 9 ended. Evaluation done at random point.
Time taken: 1.8222
Function value obtained: 6.5461
Current minimum: 6.0290
Iteration No: 10 started. Evaluating function at random point.
Iteration No: 10 ended. Evaluation done at random point.
Time taken: 0.7858
Function value obtained: 5.9536
Current minimum: 5.9536
Iteration No: 11 started. Searching for the next optimal point.
Iteration No: 11 ended. Search finished for the next optimal point.
Time taken: 0.6860
Function value obtained: 5.3423
Current minimum: 5.3423
Iteration No: 12 started. Searching for the next optimal point.


/home/uluyac/dev/miniconda3/envs/ml/lib/python3.8/site-packages/skopt/optimizer/optimizer.py:449: UserWarning: The objective has been evaluated at this point before.
  warnings.warn("The objective has been evaluated "


Iteration No: 12 ended. Search finished for the next optimal point.
Time taken: 0.7223
Function value obtained: 5.3423
Current minimum: 5.3423
Iteration No: 13 started. Searching for the next optimal point.


/home/uluyac/dev/miniconda3/envs/ml/lib/python3.8/site-packages/skopt/optimizer/optimizer.py:449: UserWarning: The objective has been evaluated at this point before.
  warnings.warn("The objective has been evaluated "


Iteration No: 13 ended. Search finished for the next optimal point.
Time taken: 0.7003
Function value obtained: 5.3423
Current minimum: 5.3423
Iteration No: 14 started. Searching for the next optimal point.


/home/uluyac/dev/miniconda3/envs/ml/lib/python3.8/site-packages/skopt/optimizer/optimizer.py:449: UserWarning: The objective has been evaluated at this point before.
  warnings.warn("The objective has been evaluated "


Iteration No: 14 ended. Search finished for the next optimal point.
Time taken: 0.7288
Function value obtained: 5.3423
Current minimum: 5.3423
Iteration No: 15 started. Searching for the next optimal point.


/home/uluyac/dev/miniconda3/envs/ml/lib/python3.8/site-packages/skopt/optimizer/optimizer.py:449: UserWarning: The objective has been evaluated at this point before.
  warnings.warn("The objective has been evaluated "


Iteration No: 15 ended. Search finished for the next optimal point.
Time taken: 0.7384
Function value obtained: 5.3423
Current minimum: 5.3423
Best score: 5.342331
</pre></table></code></div></div><p>During the searching execution, we can see two types of feedback messages. The first is:</p><blockquote><p>Iteration No: X started. Evaluating function at random point.</p></blockquote><p>This means that the algorithm is evaluating the objetive function at a random point in the hyperparameter search space, which is a standart procedure in randomized search algorithms. The interesting thing comes in the other message type,</p><blockquote><p>Iteration No: X started. Searching for the next optimal point.</p></blockquote><p>This means that the algorithm is <strong>searching for an optimal point</strong> in search space based based on <strong>points already evaluated</strong>. It’s a true <strong>hyperparameter optimization</strong> procedure. Cool, isn’t?</p><p>Now we can retrieve the best parameters found.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="s">"Best parameters found:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"  - k = </span><span class="si">{</span><span class="n">res_gp</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"  - bias_sub = </span><span class="si">{</span><span class="n">res_gp</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Best parameters found:
  - k = 10
  - bias_sub = False
</pre></table></code></div></div><p>We can even plot a <em>convergence plot</em>.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plot_convergence</span><span class="p">(</span><span class="n">res_gp</span><span class="p">,</span> <span class="p">);</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/CFRecommenderSystem/output_46_0.png" alt="png" /></p><p>We have scrachted just the surface here. <em>Scikit-optimize</em> is a powerful tool, not limited only in hyperparameter optimization, and as I said my plans are to make a more in-depth review of it in a future post. So stay tunned.</p><h1 id="item-recommendation">Item recommendation</h1><p>Now that we have defined our parameters, we can make our system do what it is suposed to: recommend items. There are many ways to acomplish this, but I optioned to go for the simple way and just recommend items most similar to a item using a <em>item-based</em> system.</p><p>Let’s make the last modification to our <em>Recommender</em> class.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Recommender</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_users</span><span class="p">,</span>
        <span class="n">n_items</span><span class="p">,</span>
        <span class="n">r_mat</span><span class="p">,</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s">"user"</span><span class="p">,</span>
        <span class="n">bias_sub</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span> <span class="o">=</span> <span class="n">build_interactions_matrix</span><span class="p">(</span><span class="n">r_mat</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span> <span class="o">=</span> <span class="n">build_similarity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span> <span class="o">=</span> <span class="n">bias_sub</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_predict_all</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_predict_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"user"</span><span class="p">:</span>
            <span class="c1"># Computes the new interaction matrix if needed.
</span>            <span class="n">iter_m</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">user_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>
                <span class="n">iter_m</span> <span class="o">-=</span> <span class="n">user_bias</span>
            <span class="c1"># An user has the higher similarity score with itself,
</span>            <span class="c1"># so we skip the first element.
</span>            <span class="n">sorted_ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_ids</span><span class="p">):</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span><span class="p">].</span><span class="n">dot</span><span class="p">(</span><span class="n">iter_m</span><span class="p">[</span><span class="n">k_users</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">user_id</span><span class="p">,</span> <span class="n">k_users</span><span class="p">]).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">pred</span> <span class="o">+=</span> <span class="n">user_bias</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"item"</span><span class="p">:</span>
            <span class="c1"># Computes the new interaction matrix if needed.
</span>            <span class="n">iter_m</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">item_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">iter_m</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">iter_m</span> <span class="o">-=</span> <span class="n">item_bias</span>
            <span class="c1"># An item has the higher similarity score with itself,
</span>            <span class="c1"># so we skip the first element.
</span>            <span class="n">sorted_ids</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_ids</span><span class="p">):</span>
                <span class="n">pred</span><span class="p">[:,</span> <span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span><span class="p">].</span><span class="n">dot</span><span class="p">(</span><span class="n">iter_m</span><span class="p">[:,</span> <span class="n">k_items</span><span class="p">].</span><span class="n">T</span><span class="p">)</span>
                <span class="n">pred</span><span class="p">[:,</span> <span class="n">item_id</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span><span class="p">,</span> <span class="n">k_items</span><span class="p">]).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">eps</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">bias_sub</span><span class="p">:</span>
                <span class="n">pred</span> <span class="o">+=</span> <span class="n">item_bias</span>
                
        <span class="k">return</span> <span class="n">pred</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_top_recomendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"user"</span><span class="p">:</span>
            <span class="c1"># For an user-based system, only similarities between users were computed.
</span>            <span class="c1"># This strategy will not be covered in this post, but a solution to this
</span>            <span class="c1"># could be of finding the top better rated items of similiar users.
</span>            <span class="c1"># I'll leave this exercise to you =]
</span>            <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">"item"</span><span class="p">:</span>
            <span class="n">sim_row</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim_m</span><span class="p">[</span><span class="n">item_id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="c1"># once again, we skip the first item for obviouos reasons.
</span>            <span class="n">items_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">sim_row</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">similarities</span> <span class="o">=</span> <span class="n">sim_row</span><span class="p">[</span><span class="n">items_idxs</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items_idxs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">similarities</span>
</pre></table></code></div></div><p>We added a method to return the \(n\) most similar items to a given item. Now, we just need to buil our model with the parameters found previously.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">rs_model</span> <span class="o">=</span> <span class="n">Recommender</span><span class="p">(</span>
    <span class="n">n_users</span><span class="p">,</span> 
    <span class="n">n_movies</span><span class="p">,</span> 
    <span class="n">ratings</span><span class="p">,</span> <span class="c1"># the model will be built on the full dataset now
</span>    <span class="n">k</span><span class="o">=</span><span class="n">res_gp</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">kind</span><span class="o">=</span><span class="s">"item"</span><span class="p">,</span> 
    <span class="n">bias_sub</span><span class="o">=</span><span class="n">res_gp</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">get_mse</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(3.2419262747936153, 3.2242363750751877)
</pre></table></code></div></div><p>We’ll also define two functions: one that maps a movie title to an id and other that maps a list of movie ids into a list of movie titles.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">title2id</span><span class="p">(</span><span class="n">mapper_df</span><span class="p">,</span> <span class="n">movie_title</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mapper_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mapper_df</span><span class="p">.</span><span class="n">movie_title</span> <span class="o">==</span> <span class="n">movie_title</span><span class="p">,</span> <span class="s">"movie_title"</span><span class="p">].</span><span class="n">index</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">ids2title</span><span class="p">(</span><span class="n">mapper_df</span><span class="p">,</span> <span class="n">ids_list</span><span class="p">):</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids_list</span><span class="p">:</span>
        <span class="n">titles</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapper_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="s">"movie_title"</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">titles</span>
</pre></table></code></div></div><p>Those functions need a dataframe with the movies ids and titles, that will act as a mapper. So we’ll load the <strong>u.item</strong> file from the dataset folder.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="c1"># Columns names
</span><span class="n">movies_mapper_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"movie_id"</span><span class="p">,</span> 
    <span class="s">"movie_title"</span><span class="p">,</span> 
    <span class="s">"release_date"</span><span class="p">,</span> 
    <span class="s">"video_release_date"</span><span class="p">,</span> 
    <span class="s">"IMDb_URL"</span><span class="p">,</span> 
    <span class="s">"unknown"</span><span class="p">,</span>
    <span class="s">"Action"</span><span class="p">,</span>
    <span class="s">"Adventure"</span><span class="p">,</span>
    <span class="s">"Animation"</span><span class="p">,</span>
    <span class="s">"Childrens"</span><span class="p">,</span>
    <span class="s">"Comedy"</span><span class="p">,</span>
    <span class="s">"Crime"</span><span class="p">,</span>
    <span class="s">"Documentary"</span><span class="p">,</span>
    <span class="s">"Drama"</span><span class="p">,</span>
    <span class="s">"Fantasy"</span><span class="p">,</span>
    <span class="s">"Film_Noir"</span><span class="p">,</span>
    <span class="s">"Horror"</span><span class="p">,</span>
    <span class="s">"Musical"</span><span class="p">,</span>
    <span class="s">"Mystery"</span><span class="p">,</span>
    <span class="s">"Romance"</span><span class="p">,</span>
    <span class="s">"Sci_Fi"</span><span class="p">,</span>
    <span class="s">"Thriller"</span><span class="p">,</span>
    <span class="s">"War"</span><span class="p">,</span>
    <span class="s">"Western"</span> 
<span class="p">]</span>
<span class="n">movies_mapper</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s">"ml-100k/u.item"</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s">"|"</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s">"latin"</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="n">movies_mapper_cols</span><span class="p">,</span>
    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s">"movie_id"</span><span class="p">,</span> <span class="s">"movie_title"</span><span class="p">],</span> <span class="c1"># we only need these columns
</span>    <span class="n">index_col</span><span class="o">=</span><span class="s">"movie_id"</span>
<span class="p">)</span>
<span class="c1"># Remove movies release years from titles
</span><span class="n">movies_mapper</span><span class="p">[</span><span class="s">"movie_title"</span><span class="p">]</span> <span class="o">=</span> <span class="n">movies_mapper</span><span class="p">[</span><span class="s">"movie_title"</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">title</span><span class="p">:</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"\(\d{4}\)"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">title</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">movies_mapper</span>
</pre></table></code></div></div><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>movie_title<tr><th>movie_id<th><tbody><tr><th>1<td>Toy Story<tr><th>2<td>GoldenEye<tr><th>3<td>Four Rooms<tr><th>4<td>Get Shorty<tr><th>5<td>Copycat<tr><th>...<td>...<tr><th>1678<td>Mat' i syn<tr><th>1679<td>B. Monkey<tr><th>1680<td>Sliding Doors<tr><th>1681<td>You So Crazy<tr><th>1682<td>Scream of Stone (Schrei aus Stein)</table><p>1682 rows × 1 columns</p></div><p>Now we can make our recommendations.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">print_recommendations</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">movie_title</span><span class="p">):</span>
    <span class="n">ids_list</span><span class="p">,</span> <span class="n">similarities</span> <span class="o">=</span> <span class="n">rs_model</span><span class="p">.</span><span class="n">get_top_recomendations</span><span class="p">(</span><span class="n">title2id</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">movie_title</span><span class="p">))</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="n">ids2title</span><span class="p">(</span><span class="n">movies_mapper</span><span class="p">,</span> <span class="n">ids_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">similarities</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">similarity</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> -- </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"Toy Story"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.73 -- Star Wars
0.70 -- Return of the Jedi
0.69 -- Independence Day (ID4)
0.66 -- Rock, The
0.64 -- Mission: Impossible
0.64 -- Willy Wonka and the Chocolate Factory
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"Batman Returns"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.71 -- Batman
0.64 -- Batman Forever
0.62 -- Stargate
0.62 -- Die Hard: With a Vengeance
0.61 -- True Lies
0.61 -- Crow, The
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"GoldenEye"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.66 -- Under Siege
0.62 -- Top Gun
0.62 -- True Lies
0.62 -- Batman
0.60 -- Stargate
0.60 -- Cliffhanger
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"Godfather, The"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.70 -- Star Wars
0.67 -- Godfather: Part II, The
0.65 -- Fargo
0.63 -- Return of the Jedi
0.59 -- Raiders of the Lost Ark
0.58 -- Pulp Fiction
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"Billy Madison"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.50 -- Dumb &amp; Dumber
0.49 -- Ace Ventura: Pet Detective
0.45 -- Hot Shots! Part Deux
0.44 -- Brady Bunch Movie, The
0.44 -- Young Guns II
0.43 -- Tommy Boy
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"Lion King, The"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.75 -- Aladdin
0.69 -- Beauty and the Beast
0.68 -- Forrest Gump
0.66 -- Jurassic Park
0.65 -- E.T. the Extra-Terrestrial
0.65 -- Empire Strikes Back, The
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">print_recommendations</span><span class="p">(</span><span class="n">rs_model</span><span class="p">,</span> <span class="n">movies_mapper</span><span class="p">,</span> <span class="s">"Star Wars"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>0.88 -- Return of the Jedi
0.76 -- Raiders of the Lost Ark
0.75 -- Empire Strikes Back, The
0.73 -- Toy Story
0.70 -- Godfather, The
0.69 -- Independence Day (ID4)
</pre></table></code></div></div><h1 id="conclusion">Conclusion</h1><p>What can we say about those recommendations?</p><p>Some recommendations are pretty good. For example, “Batman Returns” is similar to other Batman movies, that’s for sure. “The Lion King” is similar to “Aladdin” and “Beauty and the Beast” (Disney movies). “Star Wars” is similar to other Star Wars movies.</p><p>Some of them does not make much sense. “Toy Story” does not seems so similar to “The Rock” and “Mission: Impossible” to me. “The Lion King” is not so similar to “Jurassic Park” too, aside that both have animals as their main feature. And I certainly cannot understand the similarity between “The Godfather” movies with “Star Wars” movies.</p><p>Personal conclusions aside, there are some well-known advantages of memory-based Collaborative Filtering systems in literature. Some of them are:</p><ul><li><strong>Explainability of the results:</strong> which is an important aspect of recommendations systems;</li><li><strong>Easy of creation and use:</strong> all methodology is purely based in manipulations of the interactions matrix;</li><li><strong>Content-independence of the items being recommended:</strong> no descriptions, nor genre definitions, nor color definitions, nor size definition, etc. No metadata at all.</li></ul><p>But nothing in this world is perfect, and this approach suffers from disadvantages too. Some of them are:</p><ul><li><strong>Performance decreases when data gets more sparse:</strong> which occurs frequently with web-related items;</li><li><strong>Adding new items becomes more complicated:</strong> since the data sctructures representations as an interactions matrix relies on a specific <em>vector space</em>, adding new items requires inclusion of the new item and the re-insertion of all elements in the structure.</li><li><strong>Recommendations tend to be already popular:</strong> items from the so-called <a href="https://en.wikipedia.org/wiki/Long_tail">long-tail</a> section might get ignored.</li></ul><p>The notebook of this post can found <a href="https://github.com/TheCamilovisk/DSNotebooks/blob/main/RecommenderSystems/CollaborativeFilteringMemoryBased.ipynb">here</a>.</p><p>A great thanks to <a href="https://www.ethanrosenthal.com/#">Ethan Rosenthal</a>, the author of the <a href="https://www.ethanrosenthal.com/2015/11/02/intro-to-collaborative-filtering/">blog post</a> which of the ideas and concepts presented here were based on.</p><p>Other usefull links:</p><ul><li><a href="https://realpython.com/build-recommendation-engine-collaborative-filtering/#model-based">Wikipedia’s article on Collaborative Filtering.</a></li><li><a href="https://realpython.com/build-recommendation-engine-collaborative-filtering/#model-based">Real Python post on Collaborative Filtering.</a></li><li><a href="https://data-flair.training/blogs/data-science-r-movie-recommendation/">Data Flair Recommendations System Project in R.</a></li><li><a href="https://scikit-optimize.github.io/stable/">Scikit-optimize page.</a></li></ul><p>Books of interest:</p><ul><li><a href="https://www.amazon.com.br/dp/1107077230/?tag=n">Mining of Massive Datasets</a> by Jure Leskovec, Anand Rajaraman, Jeff Ullman</li><li><a href="https://www.amazon.com.br/dp/0596529325/?tag=n">Programming Collective Intelligence</a> by Toby Segaran</li></ul><p>Thanks for reading to the end, and stay tuned for new posts.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/data-science/'>Data Science</a>, <a href='/categories/recommender-systems/'>Recommender Systems</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/recommender-systems/" class="post-tag no-text-decoration" >recommender systems</a> <a href="/tags/data-science/" class="post-tag no-text-decoration" >data science</a> <a href="/tags/skoptim/" class="post-tag no-text-decoration" >skoptim</a> <a href="/tags/collaborative-filtering/" class="post-tag no-text-decoration" >collaborative filtering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Collaborative Filtering based Recommender System - Camilo Gonçalves&url=https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Collaborative Filtering based Recommender System - Camilo Gonçalves&u=https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Collaborative Filtering based Recommender System - Camilo Gonçalves&url=https://thecamilovisk.github.io//posts/Collaborative-Filtering-Recommender-System/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Customer-Segmentation/">Customer Segmentation in Python</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/data-science/">data science</a> <a class="post-tag" href="/tags/skoptim/">skoptim</a> <a class="post-tag" href="/tags/sklearn/">sklearn</a> <a class="post-tag" href="/tags/silhouette-coefficient/">silhouette coefficient</a> <a class="post-tag" href="/tags/recommender-systems/">recommender systems</a> <a class="post-tag" href="/tags/optimal-clustering/">optimal clustering</a> <a class="post-tag" href="/tags/machine-learning/">machine learning</a> <a class="post-tag" href="/tags/kmeans/">kmeans</a> <a class="post-tag" href="/tags/elbow-method/">elbow method</a> <a class="post-tag" href="/tags/customer-segmentation/">customer segmentation</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Customer-Segmentation/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Feb 4 <i class="unloaded">2021-02-04T19:38:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Customer Segmentation in Python</h3><div class="text-muted small"><p> In my last post we hade a brief discussion about Recommender Systems, one of the most widespread application of machine learning technology in industry. In this post we’ll talk about Customer Segm...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled"><p>-</p></span> <a href="/posts/Customer-Segmentation/" class="btn btn-outline-primary"><p>Customer Segmentation in Python</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/camilolgon">Camilo Gonçalves</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/data-science/">data science</a> <a class="post-tag" href="/tags/skoptim/">skoptim</a> <a class="post-tag" href="/tags/sklearn/">sklearn</a> <a class="post-tag" href="/tags/silhouette-coefficient/">silhouette coefficient</a> <a class="post-tag" href="/tags/recommender-systems/">recommender systems</a> <a class="post-tag" href="/tags/optimal-clustering/">optimal clustering</a> <a class="post-tag" href="/tags/machine-learning/">machine learning</a> <a class="post-tag" href="/tags/kmeans/">kmeans</a> <a class="post-tag" href="/tags/elbow-method/">elbow method</a> <a class="post-tag" href="/tags/customer-segmentation/">customer segmentation</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://thecamilovisk.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
